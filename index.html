<!DOCTYPE html>
<html lang="en">

<head>
  <title>Play Your Music (for Google Drive)</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#000000">
  <meta name="description" content="Play music from Google Drive.">
  <link rel="manifest" href="/manifest.json">
  <link rel="shortcut icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

<header>
  <button id="menu-toggle">▾</button>
  <h1 style="display: none;">▶ Play Your Music</h1>
  <nav id="menu">
    <h2>API Counter</h2>
    <div id="count"></div>
    <h2>Authentication</h2>
    <button id="authorize_button" style="display: none;">Sign In</button>
    <button id="signout_button" style="display: none;">Sign Out</button>
  </nav>
</header>

<div id="albums"></div>
<div id="track-list"></div>
<button id="track-list-close">&times;</button>

<div class="audio-player">

  <progress id="seekObj" value="0" max="1"></progress>
  
  <div id="audio-time">
    <small class="start-time">00:00</small> / 
    <small class="end-time">00:00</small>
  </div>

  <img class="album-image" src="red.png" />

  <p class="audio-song-text">Now Playing...</p>

  <div id="play-btn">▶</div>

  <div class="audio-wrapper" id="player-container" href="javascript:;">
    <audio id="player" ontimeupdate="initProgressBar()">
      <source src="" type="audio/mp3">
    </audio>
  </div>

</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script type="text/javascript" src="auth.js"></script>
<script type="text/javascript" src="player.js"></script>
<script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>
<script type="text/javascript" src="api.js"></script>


<script type="text/javascript">

$( document ).ready(function() {

  $(document).on('click', '.track', function(e){
    e.preventDefault();

    // reset track highlight
    $(".track-active").removeClass('track-active');

    var trackId = $(this).attr("data-track-id");
    playTrack(trackId);

    $('.album-image').attr('src', $('.track-list-album').attr('src') );

  });

  $(document).on('click', '.album', function(e){
    e.preventDefault();

    // reset track list 
    $('#track-list').html("");

    var albumId = $(this).attr("data-album-id");
    listTracks(albumId);

    $('#track-list').prepend("<span style='display: block; clear: both;'></span>");
    $('#track-list').prepend("<span class='track-list-album-name'>" + $(this).attr("data-album-name") + "</span>");
    $('#track-list').prepend("<img class='track-list-album' src='" + $(this).children(":first").attr('src') + "'/>");

    $('#track-list').css('min-height', $('#albums').height() );
    $('#track-list').show();

  });

  $(document).on('click', '#track-list-close', function(e){
    //e.preventDefault();
    $('#track-list').hide();
    $('#track-list-close').hide();
  });

  $(document).on('click', '#menu-toggle', function(e){
    //e.preventDefault();
    $('#menu').toggle();
  });

  var audio = $("audio");  
  audio[0].addEventListener('ended',function(){
    var currentTrackId = $('source').attr("data-track-id");
    var nextTrackId = $(".track[data-track-id='" + currentTrackId + "']").next().attr("data-track-id");

    // reset track highlight
    $(".track[data-track-id='" + currentTrackId + "']").removeClass('track-active');

    playTrack(nextTrackId);
  });

});
</script>

</body>
</html>